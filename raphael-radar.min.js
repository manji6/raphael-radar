(function(){function k(a,e,c){return a+(e-a)*c}function s(a,e,c){for(var d=[],g=0;g<e.length;g++){var b=k(a.x,e[g].x,c[g].value),f=k(a.y,e[g].y,c[g].value);d.push(""+b+" "+f)}return"M "+d.join("L ")+"L "+d[0]}function m(a,e,c,d,g,b,f,j,i){var h=this;h.raphael=a;h.chart={};h.points=[];h.cx=e;h.cy=c;h.radius=d;h.bottom=0;h.min_score=b;h.max_score=f;h.labels=g;h.score_groups=j;h.user_draw_options=i;h.global_draw_defaults={text:{fill:"#222","max-chars":10,key:true}};h.global_draw_options=$.extend(true,
h.global_draw_defaults,i)}m.prototype.draw=function(){var a=this;a.drawChartFrame();a.drawMeasures();a.drawScore();a.drawLable()};m.prototype.polygon=function(a){var e=this,c="M 100 100",d,g=a.length,b,f;for(d=0;d<g;++d){b=a[d].x;f=a[d].y;b=d==0?"M "+b+" "+f+" ":"L "+b+" "+f+" ";if(d===g-1)b+="L "+a[0].x+" "+a[0].y+" ";c+=b}return e.raphael.path(c)};m.prototype.drawChartFrame=function(){var a=this,e=a.labels.length,c=-90,d,g,b;for(d=a.bottom=0;d<e;d++){b=c/360*2*Math.PI;g=a.cx+a.radius*Math.cos(b);
b=a.cy+a.radius*Math.sin(b);a.points.push({x:g,y:b});c+=360/e;if(b>a.bottom)a.bottom=b}a.chart.frame=a.polygon(a.points).attr({stroke:"#777"})};m.prototype.drawMeasures=function(){var a=this,e=a.points,c=[],d=[],g=[],b,f,j=e.length,i,h,o,n,r=(a.max_score-a.min_score)/5;for(b=0;b<j;++b){f=e[b].x;i=e[b].y;c.push(a.raphael.path("M "+a.cx+" "+a.cy+" L "+f+" "+i).attr("stroke","#777"));d[b]=[];for(f=0;f<=5;++f){i=k(a.cx,e[b].x,f*0.2-0.025);o=k(a.cy,e[b].y,f*0.2-0.025);h=k(a.cx,e[b].x,f*0.2+0.025);n=k(a.cy,
e[b].y,f*0.2+0.025);if(a.global_draw_options.ruler_graduations!==false)if(f!==0&&f!==5){h=a.raphael.path("M "+i+" "+o+" L "+h+" "+n).attr({stroke:"#777"});h.rotate(90);d[b].push(h)}if(a.global_draw_options.ruler_text!==false)if(b===0){i=a.raphael.text(i-7,n,a.min_score+f*r).attr($.extend(true,a.global_draw_options.text,{"text-anchor":"end"}));g.push(i)}}}a.chart.measures=c;a.chart.rulers=d;a.chart.ruler_text=g};m.prototype.drawScore=function(){var a=this,e,c,d,g,b,f,j,i,h={points:{fill:"#333","stroke-width":"0",
size:4.5},text:{fill:"#222","text-anchor":"start"},lines:{"stroke-width":"1"}},o=a.score_groups.length,n=a.points,r={x:a.cx,y:a.cy},l=a.score_groups,p=a.labels;a.chart.scores=[];for(e=0;e<o;++e){b=[];var q={};f=[];i=$.extend(true,h,l[e].draw_options);if(l[e].scores)for(c=0;c<l[e].scores.length;++c)b.push({value:(l[e].scores[c]-a.min_score)/(a.max_score-a.min_score),rawValue:l[e].scores[c],label:a.labels[c]});else for(c=0;c<p.length;++c){j=l[e][p[c]]||l[e][p[c].toLowerCase().replace(" ","_")];b.push({value:(j-
a.min_score)/(a.max_score-a.min_score),rawValue:j,label:p[c]})}j=l[e].title;c=a.raphael.path(s(r,n,b)).attr(i.lines);q.line=c;for(c=0;c<b.length;c++){d=k(a.cx,n[c].x,b[c].value);g=k(a.cy,n[c].y,b[c].value);d=a.raphael.circle(d,g,i.points.size).attr(i.points);d.score=b[c];d.title=j;f.push(d)}q.points=f;if(j&&a.global_draw_options.text.key){d=a.cx-50;f=a.bottom+40+20*e;b=a.cx;c=a.raphael.path("M "+d+" "+f+" L "+b+" "+f).attr(i.lines);d=a.raphael.circle(d,f,i.points.size).attr(i.points);i=a.raphael.text(b+
10,f,j).attr(i.text);q.title={line:c,point:d,text:i}}a.chart.scores.push(q)}};m.prototype.drawLable=function(){var a=this,e=a.points,c=e.length,d,g,b,f,j;a.chart.labels=[];for(d=0;d<c;++d){j="middle";g=k(a.cx,e[d].x,1.1);b=k(a.cy,e[d].y,1.1);if(g>a.cx)j="start";if(g<a.cx)j="end";f=a.labels[d];if(f.length>a.global_draw_options.text["max-chars"])f=f.replace(" ","\n");g=a.raphael.text(g,b,f).attr($.extend(true,a.global_draw_options.text,{"text-anchor":j}));a.chart.labels.push(g)}};Raphael.fn.radarchart=
function(a,e,c,d,g,b,f,j){a=new m(this,a,e,c,d,g,b,f,j);a.draw();return a.chart}})();
